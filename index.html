<html>
  <head>
    <script src="/static/jquery-3.4.1.min.js"></script>
    <script src="/static/slotmachine.js"></script>
    <script src="/static/jquery.slotmachine.js"></script>
    <link
      rel="stylesheet"
      href="/static/bootstrap.min.css"
      type="text/css"
      media="screen"
    />
    <link
      rel="stylesheet"
      href="/static/jquery.slotmachine.min.css"
      type="text/css"
      media="screen"
    />
    <link
      rel="stylesheet"
      href="/static/style.css"
      type="text/css"
      media="screen"
    />
  </head>

  <body>
    <div class="modal-wrapper">
      <div class="modal">
        <div class="head">
          <a class="btn-close 1" href="javascript:;"></a>
        </div>
        <div class="content"></div>
      </div>
    </div>
    <h1>
      幸运数字预测
    </h1>
    <h2>Get Your Lucky Number!</h2>
    <div id="randomize">
      <div class="container">
        <div class="row">
          <div class="col-sm-1">
            <div>
              <div
                id="machine1"
                class="randomizeMachine"
                style="overflow: hidden;"
              >
                <div
                  class="slotMachineContainer"
                  style="transition: all 0.4s ease-out 0s; transform: matrix(1, 0, 0, 1, 0, -500);"
                >
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-1">
            <div>
              <div
                id="machine2"
                class="randomizeMachine"
                style="overflow: hidden;"
              >
                <div
                  class="slotMachineContainer"
                  style="transition: all 0.4s ease-out 0s; transform: matrix(1, 0, 0, 1, 0, -500);"
                >
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-1">
            <div>
              <div
                id="machine3"
                class="randomizeMachine"
                style="overflow: hidden;"
              >
                <div
                  class="slotMachineContainer"
                  style="transition: all 0.4s ease-out 0s; transform: matrix(1, 0, 0, 1, 0, -500);"
                >
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-1">
            <div>
              <div
                id="machine4"
                class="randomizeMachine"
                style="overflow: hidden;"
              >
                <div
                  class="slotMachineContainer"
                  style="transition: all 0.4s ease-out 0s; transform: matrix(1, 0, 0, 1, 0, -500);"
                >
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-1">
            <div>
              <div
                id="machine5"
                class="randomizeMachine"
                style="overflow: hidden;"
              >
                <div
                  class="slotMachineContainer"
                  style="transition: all 0.4s ease-out 0s; transform: matrix(1, 0, 0, 1, 0, -500);"
                >
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-1">
            <div>
              <div
                id="machine6"
                class="randomizeMachine"
                style="overflow: hidden;"
              >
                <div
                  class="slotMachineContainer"
                  style="transition: all 0.4s ease-out 0s; transform: matrix(1, 0, 0, 1, 0, -500);"
                >
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-1">
            <div>
              <div
                id="machine7"
                class="randomizeMachine"
                style="overflow: hidden;"
              >
                <div
                  class="slotMachineContainer"
                  style="transition: all 0.4s ease-out 0s; transform: matrix(1, 0, 0, 1, 0, -500);"
                >
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                  <div class="text-center">0</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <span style="text-align: center;" id="wish_message"></span>
        </div>
      </div>
    </div>
    <div class="row">
      <button
        id="randomizeButton"
        style="margin:auto;margin-top:50px;font-size:60px;border-radius:15px;"
        class="btn btn-warning"
      >
        <span style="display:block">点击开始</span>
        <span>GO</span>
      </button>
    </div>
  </body>
</html>
<script>
  const btn = document.querySelector("#randomizeButton");
  const results = {
    machine1: document.querySelector("#machine1Result"),
    machine2: document.querySelector("#machine2Result"),
    machine3: document.querySelector("#machine3Result"),
    machine4: document.querySelector("#machine4Result"),
    machine5: document.querySelector("#machine5Result"),
    machine6: document.querySelector("#machine6Result"),
    machine7: document.querySelector("#machine7Result")
  };
  const el1 = document.querySelector("#machine1");
  const el2 = document.querySelector("#machine2");
  const el3 = document.querySelector("#machine3");
  const el4 = document.querySelector("#machine4");
  const el5 = document.querySelector("#machine5");
  const el6 = document.querySelector("#machine6");
  const el7 = document.querySelector("#machine7");
  const machine1 = new SlotMachine(el1, { active: 0 });
  const machine2 = new SlotMachine(el2, { active: 1 });
  const machine3 = new SlotMachine(el3, { active: 2 });
  const machine4 = new SlotMachine(el4, { active: 3 });
  const machine5 = new SlotMachine(el5, { active: 4 });
  const machine6 = new SlotMachine(el6, { active: 5 });
  const machine7 = new SlotMachine(el7, { active: 6 });

  let message_array = ["恭喜发财！万事如意！", "鼠年大吉！"];

  function onComplete(active) {
    // results[this.element.id].innerText = `Index: ${this.active}`;
    console.log("this.element id", this.element.id);
    $("#wish_message").html(message_array[0]);
  }

  function shuffle(arr) {
    for (
      var j, x, i = arr.length;
      i;
      j = parseInt(Math.random() * i), x = arr[--i], arr[i] = arr[j], arr[j] = x
    );
    return arr;
  }

  let array = [];
  for (let i = 1; i < 49; i++) array.push(i);

  const machines = [
    machine1,
    machine2,
    machine3,
    machine4,
    machine5,
    machine6,
    machine7
  ];
  let val = "";
  let timeout = 0;
  let i = 1;
  btn.addEventListener("click", () => {
    array = shuffle(array);
    console.log("array is", array);
    let val = "";
    let timeout = 0;
    let i = 1;
    message_array = shuffle(message_array);
    for (let m of machines) {
      (function(i, timeout) {
        setTimeout(() => {
          val = $("#machine" + i).find(".text-center");
          let count = 0;
          for (let x of val) {
            $(x).text(array[count + i - 1]);
            count += 1;
          }
          console.log("machine is ", i);
          m.shuffle(8, onComplete);
        }, 400);
      })(i, timeout);
      // setTimeout(() => {
      //   val = $("#machine" + i).find(".text-center");
      //   $(val).text(array[i - 1]);
      //   console.log("machine is ", i);
      //   m.shuffle(5, onComplete);
      // }, timeout);
      timeout += 200;
      i += 1;
    }
  });
  $(document).ready(function() {
    $(".btn-close").click(function() {
      $(".modal-wrapper").toggleClass("open");
      $(".page-wrapper").toggleClass("blur");
      return false;
    });
  });
</script>
